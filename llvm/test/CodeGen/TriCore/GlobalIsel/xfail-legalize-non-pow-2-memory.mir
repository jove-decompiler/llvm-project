# RUN: llc -O0 -mtriple=tricore -global-isel -run-pass=legalizer -verify-machineinstrs %s -o - | FileCheck %s
# XFAIL: *

# When lowering non-pow-2 load/stores GlobalISel uses s64 as the type for the
# offset operand of the G_PTR_ADD instruction. Our target does not have 64-bit
# pointers and therefore requires s32 offsets. However, the constant of a
# G_PTR_ADD can only be widened, but not narrowed.
#
# This is simply a shortcoming of GlobalISel that needs to be fixed. A better
# solution would be to use the smallest power-of-2 type that can fit the
# constant and widen it later if necessary.
#
# We should try to fix and upstream this. Until then we keep this xfail test
# to not forget about it later.

---
name:            test_ptr_add_constant_type
body:             |
  bb.0:
    ; CHECK: {{%[0-9]+}}:_(p0) = G_PTR_ADD {{%[0-9]+}}(p0), {{%[0-9]+}}(s32)
    %0:_(p0) = COPY $a4
    %1:_(s24) = G_LOAD %0(p0) :: (load 3, align 2)
    G_STORE %1(s24), %0(p0) :: (store 3, align 2)
...
